(self.webpackChunk_doordash_app_chat_agent=self.webpackChunk_doordash_app_chat_agent||[]).push([[179],{78451:(e,t,n)=>{"use strict";var r,o,a,i=n(67294),c=n(73935),u=n(2804),l=n(45861),s={loading:!1},f=(0,u.cn)({key:"chatInfoState",default:s}),d=(0,u.cn)({key:"chatEndedState",default:s}),p=function(){return(0,u.Zl)(d)},y=(0,u.cn)({key:"quickTextInfoState",default:s}),m=(0,u.cn)({key:"initializedState",default:!1}),h=function(){return(0,u.sJ)(m)};function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}(o=r||(r={})).ChatInfo="chat_info",o.EndChat="end_chat",o.Ping="ping",o.QuickText="quick_text",function(e){e.Error="error",e.Success="success"}(a||(a={}));var v="https://figment--sendbird--c.visualforce.com";function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var E=function(e){var t=h();i.useEffect((function(){t&&(console.log("[App] Sending message: ".concat(e.type)),parent.postMessage(e,v))}),[t])},w=function(){var e=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}}(e,t)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}((0,u.FV)(d),2),t=e[0],n=e[1],o={type:r.EndChat};return[function(){n({loading:!0}),parent.postMessage(o,v)},t]},S=n(76575),k=n(56877),I=n(15517);const C=function(){var e=p();return i.createElement(I.bZ,{dismissText:"Dismiss",onDismiss:function(){return e({loading:!1})},subtitle:"There was an error while trying to end the chat session.",title:"Unable to end chat"})};var A=n(27366),T=n(34144),_=(0,k.Y4)(T.ZP.div.withConfig({displayName:"styles__Wrapper",componentId:"sc-1ctar1i-0"})(["align-items:center;background-color:",";display:flex;height:100vh;justify-content:center;width:100%;"],(function(e){return e.theme.Colors.BackgroundPrimary})));const x=function(){return i.createElement(_,null,i.createElement(A.Z,{color:A.Z.Colors.Dark}))};function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const Z=function(){var e,t,n=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(o)throw a}}return n}}(e,t)||function(e,t){if(e){if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(w(),2),o=n[0],a=n[1],c=function(){var e={type:r.ChatInfo};return E(e),(0,u.sJ)(f)}(),l=function(){var e={type:r.QuickText};return E(e),(0,u.sJ)(y)}();return c.error?i.createElement("div",null,"Error"):c.loading||!c.data?i.createElement(x,null):i.createElement(i.Fragment,null,i.createElement(S.Z,{accessToken:c.data.sendbirdToken,appId:c.data.sendbirdAppId,channelUrl:c.data.sendbirdChannelUrl,fieldMap:(null===(e=l.data)||void 0===e?void 0:e.fieldMap)||{},header:{iconType:k.JO.Types.ChatConversation,onEndChat:o},onChatResume:function(){return null},quickTextItems:(null===(t=l.data)||void 0===t?void 0:t.items)||[],userId:c.data.sendbirdUserId}),!!a.error&&i.createElement(C,null))},M=function(){return function(){var e=p(),t=(0,u.Zl)(f),n=(0,u.Zl)(m),o=(0,u.Zl)(y),c=function(e){switch(e.status){case a.Success:return{error:null,loading:!1,data:e.data};case a.Error:default:return{error:e.message,loading:!1}}},l=function(a){switch(console.log("[App] Received message: ".concat(a.type," "),a),a.type){case r.ChatInfo:t(c(a.payload));break;case r.EndChat:e(c(a.payload));break;case r.Ping:n(!0);break;case r.QuickText:o(c(a.payload));break;default:console.log("[App]: Unhandled message type")}};i.useEffect((function(){var e=function(e){!function(e){return"object"===g(e.data)&&e.data.type&&"string"==typeof e.data.type}(e)?console.log("[App] Received message with unexpected format, ignoring.",e):l(e.data)};return window.addEventListener("message",e),function(){window.removeEventListener("message",e)}}),[])}(),function(){var e=h(),t=i.useRef(),n=function(){t.current&&window.clearInterval(t.current)};i.useEffect((function(){return t.current=window.setInterval((function(){parent.postMessage({type:r.Ping},v)}),1e3),function(){return n()}}),[]),i.useEffect((function(){e&&n()}),[e])}(),i.createElement(l.ZP,null,i.createElement(Z,null))};var O=document.querySelector("#root");if(!O)throw new Error("no root element");c.render(i.createElement(u.Wh,null,i.createElement(M,null)),O)}},0,[[78451,303,566]]]);