(()=>{"use strict";var e={20:e=>{var t="%[a-f0-9]{2}",n=new RegExp(t,"gi"),r=new RegExp("("+t+")+","gi");function a(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),r=e.slice(t);return Array.prototype.concat.call([],a(n),a(r))}function s(e){try{return decodeURIComponent(e)}catch(s){for(var t=e.match(n),r=1;r<t.length;r++)t=(e=a(t,r).join("")).match(n);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},n=r.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var a=s(n[0]);a!==n[0]&&(t[n[0]]=a)}n=r.exec(e)}t["%C2"]="�";for(var o=Object.keys(t),i=0;i<o.length;i++){var c=o[i];e=e.replace(new RegExp(c,"g"),t[c])}return e}(e)}}},806:e=>{e.exports=function(e,t){for(var n={},r=Object.keys(e),a=Array.isArray(t),s=0;s<r.length;s++){var o=r[s],i=e[o];(a?-1!==t.indexOf(o):t(o,i,e))&&(n[o]=i)}return n}},563:(e,t,n)=>{const r=n(610),a=n(20),s=n(500),o=n(806);function i(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function c(e,t){return t.encode?t.strict?r(e):encodeURIComponent(e):e}function u(e,t){return t.decode?a(e):e}function l(e){return Array.isArray(e)?e.sort():"object"==typeof e?l(Object.keys(e)).sort(((e,t)=>Number(e)-Number(t))).map((t=>e[t])):e}function d(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function f(e){const t=(e=d(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function h(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function g(e,t){i((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,r)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===r[e]&&(r[e]={}),r[e][t[1]]=n):r[e]=n};case"bracket":return(e,n,r)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==r[e]?r[e]=[].concat(r[e],n):r[e]=[n]:r[e]=n};case"comma":case"separator":return(t,n,r)=>{const a="string"==typeof n&&n.includes(e.arrayFormatSeparator),s="string"==typeof n&&!a&&u(n,e).includes(e.arrayFormatSeparator);n=s?u(n,e):n;const o=a||s?n.split(e.arrayFormatSeparator).map((t=>u(t,e))):null===n?n:u(n,e);r[t]=o};case"bracket-separator":return(t,n,r)=>{const a=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!a)return void(r[t]=n?u(n,e):n);const s=null===n?[]:n.split(e.arrayFormatSeparator).map((t=>u(t,e)));void 0!==r[t]?r[t]=[].concat(r[t],s):r[t]=s};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t),r=Object.create(null);if("string"!=typeof e)return r;if(!(e=e.trim().replace(/^[?#&]/,"")))return r;for(const a of e.split("&")){if(""===a)continue;let[e,o]=s(t.decode?a.replace(/\+/g," "):a,"=");o=void 0===o?null:["comma","separator","bracket-separator"].includes(t.arrayFormat)?o:u(o,t),n(u(e,t),o,r)}for(const e of Object.keys(r)){const n=r[e];if("object"==typeof n&&null!==n)for(const e of Object.keys(n))n[e]=h(n[e],t);else r[e]=h(n,t)}return!1===t.sort?r:(!0===t.sort?Object.keys(r).sort():Object.keys(r).sort(t.sort)).reduce(((e,t)=>{const n=r[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=l(n):e[t]=n,e}),Object.create(null))}t.extract=f,t.parse=g,t.stringify=(e,t)=>{if(!e)return"";i((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const n=n=>t.skipNull&&null==e[n]||t.skipEmptyString&&""===e[n],r=function(e){switch(e.arrayFormat){case"index":return t=>(n,r)=>{const a=n.length;return void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,[c(t,e),"[",a,"]"].join("")]:[...n,[c(t,e),"[",c(a,e),"]=",c(r,e)].join("")]};case"bracket":return t=>(n,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,[c(t,e),"[]"].join("")]:[...n,[c(t,e),"[]=",c(r,e)].join("")];case"comma":case"separator":case"bracket-separator":{const t="bracket-separator"===e.arrayFormat?"[]=":"=";return n=>(r,a)=>void 0===a||e.skipNull&&null===a||e.skipEmptyString&&""===a?r:(a=null===a?"":a,0===r.length?[[c(n,e),t,c(a,e)].join("")]:[[r,c(a,e)].join(e.arrayFormatSeparator)])}default:return t=>(n,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,c(t,e)]:[...n,[c(t,e),"=",c(r,e)].join("")]}}(t),a={};for(const t of Object.keys(e))n(t)||(a[t]=e[t]);const s=Object.keys(a);return!1!==t.sort&&s.sort(t.sort),s.map((n=>{const a=e[n];return void 0===a?"":null===a?c(n,t):Array.isArray(a)?0===a.length&&"bracket-separator"===t.arrayFormat?c(n,t)+"[]":a.reduce(r(n),[]).join("&"):c(n,t)+"="+c(a,t)})).filter((e=>e.length>0)).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[n,r]=s(e,"#");return Object.assign({url:n.split("?")[0]||"",query:g(f(e),t)},t&&t.parseFragmentIdentifier&&r?{fragmentIdentifier:u(r,t)}:{})},t.stringifyUrl=(e,n)=>{n=Object.assign({encode:!0,strict:!0},n);const r=d(e.url).split("?")[0]||"",a=t.extract(e.url),s=t.parse(a,{sort:!1}),o=Object.assign(s,e.query);let i=t.stringify(o,n);i&&(i=`?${i}`);let u=function(e){let t="";const n=e.indexOf("#");return-1!==n&&(t=e.slice(n)),t}(e.url);return e.fragmentIdentifier&&(u=`#${c(e.fragmentIdentifier,n)}`),`${r}${i}${u}`},t.pick=(e,n,r)=>{r=Object.assign({parseFragmentIdentifier:!0},r);const{url:a,query:s,fragmentIdentifier:i}=t.parseUrl(e,r);return t.stringifyUrl({url:a,query:o(s,n),fragmentIdentifier:i},r)},t.exclude=(e,n,r)=>{const a=Array.isArray(n)?e=>!n.includes(e):(e,t)=>!n(e,t);return t.pick(e,a,r)}},500:e=>{e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]}},610:e=>{e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,(e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))}},t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}(()=>{n(563);var e=window.agentUserId,t=window.caseId,r=window.quickTextFieldMap,a=(window.location.search,window.sendbirdChannelUrl),s=window.sendbirdSFDCInstance,o=window.sforce;function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var c,u,l,d,f,h,g=function(e){return"object"===i(e.data)&&e.data.type&&"string"==typeof e.data.type};function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){T(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}(u=c||(c={})).TX_CHAT_INFO_RESPONSE="tx_chat_info_response",u.TX_CHAT_END_CHAT_RESPONSE="tx_chat_end_chat_response",u.TX_CHAT_PING_RESPONSE="tx_chat_ping_response",u.TX_CHAT_QUICK_TEXT_RESPONSE="tx_chat_quick_text_response",u.TX_CHAT_SHOULD_CONNECT_RESPONSE="tx_chat_should_connect_response",u.TX_CHAT_TRANSFER_QUEUES_RESPONSE="tx_chat_transfer_queues_response",u.TX_CHAT_TRANSFER_CHAT_RESPONSE="tx_chat_transfer_chat_response",u.TX_CHAT_CLOSE_TAB_RESPONSE="tx_chat_close_tab_response",u.TX_CHAT_INFO_REQUEST="tx_chat_info_request",u.TX_CHAT_END_CHAT_REQUEST="tx_chat_end_chat_request",u.TX_CHAT_PING_REQUEST="tx_chat_ping_request",u.TX_CHAT_QUICK_TEXT_REQUEST="tx_chat_quick_text_request",u.TX_CHAT_SHOULD_CONNECT_REQUEST="tx_chat_should_connect_request",u.TX_CHAT_TRANSFER_QUEUES_REQUEST="tx_chat_transfer_queues_request",u.TX_CHAT_TRANSFER_CHAT_REQUEST="tx_chat_transfer_chat_request",u.TX_CHAT_CLOSE_TAB_REQUEST="tx_chat_close_tab_request",function(e){e.ChatInfo="chat_info",e.EndChat="end_chat",e.Ping="ping",e.QuickText="quick_text",e.ShouldConnect="should_connect",e.TransferQueues="transfer_queues",e.TransferChat="transfer_chat",e.CloseTab="close_tab"}(l||(l={})),function(e){e.Visible="visible"}(d||(d={})),function(e){e.UnreadMessageCountChanged="unread_message_count_changed",e.ActiveTabChanged="active_tab_changed"}(f||(f={})),function(e){e.Error="error",e.Success="success",e.Reset="reset"}(h||(h={}));var _={hasTouchEvents:void 0!==window.ontouchstart,innerWidth:window.innerWidth,innerHeight:window.innerHeight,location:window.location,navigator:window.navigator},y=function(e,t){(window&&window.analytics&&"function"==typeof window.analytics.track?window.analytics.track:function(){})(e,b(b({appName:"app-chat-agent"},t),_))};function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m="background:".concat("#F6E61B"),E="color:".concat("#191919"),S="background:".concat("#B71000"),v="color:".concat("#ffffff"),k=function(){function n(e,t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.apexController=e,this.child=t,this.isSubtabFocused=!0,this.isTabFocused=!0,o.console.getEnclosingPrimaryTabId((function(e){r.tabId=e.id,o.console.getFocusedPrimaryTabId((function(e){r.isTabFocused=e.id===r.tabId}))})),o.console.getEnclosingTabId((function(e){r.subTabId=e.id,o.console.getFocusedSubtabId((function(e){r.isSubtabFocused=e.id===r.subTabId}))})),o.console.onFocusedSubtab((function(e){var t=r.subTabId===e.id,n=r.isSubtabFocused!==t;if(r.isSubtabFocused=t,n)try{r.sendVisibleMessage()}catch(e){console.log("Hit an error ".concat(e&&e.message," ").concat(e&&e.stack))}}))}return function(e,t,n){t&&C(e.prototype,t)}(n,[{key:"handleMessage",value:function(e){switch(e.type){case l.ChatInfo:this.handleChatInfoRequest();break;case l.EndChat:this.handleEndChat();break;case l.Ping:this.handlePingRequest();break;case l.QuickText:this.handleQuickTextRequest();break;case l.ShouldConnect:this.handleShouldConnectRequest();break;case l.TransferChat:this.handleTransferChat(e);break;case l.TransferQueues:this.handleTransferQueuesRequest();break;case f.UnreadMessageCountChanged:this.handleUnreadMessages(e);break;case f.ActiveTabChanged:this.handleActiveTabChanged(e);break;default:console.log("[Controller] Unhandled message.",e)}}},{key:"handleEndChat",value:function(){var n=this;this.apexController.endChat(a).then((function(){var r={type:l.EndChat,payload:{data:void 0,status:h.Success}};y(c.TX_CHAT_END_CHAT_RESPONSE,{agentUserId:e,caseId:t,sendbirdChannelUrl:a,status:h.Success}),n.sendMessage(r)})).catch((function(r){n.sendErrorMessage(r.message,l.EndChat),y(c.TX_CHAT_END_CHAT_RESPONSE,{agentUserId:e,caseId:t,sendbirdChannelUrl:a,status:h.Error})}))}},{key:"handleActiveTabChanged",value:function(e){var t=this;return Promise.resolve().then((function(){var n=e.payload.focusedTabId===t.tabId,r=n!==t.isTabFocused;if(t.isTabFocused=n,r)return t.sendVisibleMessage()})).catch((function(e){console.log("Hit an error ".concat(e&&e.message," ").concat(e&&e.stack))}))}},{key:"sendVisibleMessage",value:function(){var e={type:d.Visible,payload:{status:h.Success,data:this.isTabFocused&&this.isSubtabFocused}};return this.sendMessage(e)}},{key:"handleUnreadMessages",value:function(e){var t=this,n=e&&e.payload&&e.payload.unreadMessageCount;null!=n&&"number"==typeof n?n?this.flashingTabTimer||this.flashingTabInitialTimeout||(this.flashingTabInitialTimeout=window.setTimeout((function(){var e=0;t.flashingTabTimer=window.setInterval((function(){!function(n){var r=e?m:S,a=e?E:v;o.console.setTabStyle(r,t.tabId,(function(e){e.success?o.console.setTabTextStyle(a,t.tabId,n):n(e)}))}((function(n){n.success?e=0===e?1:0:(console.log("Failed to flash the tab. Clearing timer."),t.flashingTabTimer&&clearInterval(t.flashingTabTimer),t.flashingTabTimer=void 0)}))}),1e3)}),1e3)):(this.flashingTabTimer||this.flashingTabInitialTimeout)&&(this.flashingTabTimer&&(clearInterval(this.flashingTabTimer),this.flashingTabTimer=void 0),this.flashingTabInitialTimeout&&(clearTimeout(this.flashingTabInitialTimeout),this.flashingTabInitialTimeout=void 0),o.console.setTabStyle(null,this.tabId,(function(e){e.success?o.console.setTabTextStyle(null,t.tabId,(function(e){e.success?console.log("Successfully cleared flashing from tabs"):console.log("Was unable to clear flashing tab text. Did clear tab style")})):console.log("Was unable to clear flashing tab!")}))):console.log("Received invalid unread message count update. Ignoring ",e)}},{key:"handleTransferChat",value:function(n){var r,s=this;this.apexController.transferChat(t,n.payload.id).then((function(n){if(n!==t)throw y(c.TX_CHAT_TRANSFER_CHAT_RESPONSE,{agentUserId:e,caseId:t,sendbirdChannelUrl:a,response:n,status:h.Error}),new Error(n);y(c.TX_CHAT_TRANSFER_CHAT_RESPONSE,{agentUserId:e,caseId:t,sendbirdChannelUrl:a,response:n,status:h.Success}),r={type:l.TransferChat,payload:{status:h.Success,data:n}},setTimeout((function(){o.console.getEnclosingTabId((function(e){var t=e.id;o.console.closeTab(t)}))}),3e3),s.sendMessage(r)})).catch((function(n){y(c.TX_CHAT_TRANSFER_CHAT_RESPONSE,{agentUserId:e,caseId:t,sendbirdChannelUrl:a,status:h.Error,error:n.message}),s.sendErrorMessage(n.message,l.TransferChat)}))}},{key:"handlePingRequest",value:function(){var n={type:l.Ping};y(c.TX_CHAT_PING_RESPONSE,{agentUserId:e,caseId:t,sendbirdChannelUrl:a,status:h.Success}),this.sendMessage(n)}},{key:"handleQuickTextRequest",value:function(){var n=this;this.apexController.getQuickText().then((function(s){var o={type:l.QuickText,payload:{data:{fieldMap:r,items:s.map((function(e){return{message:e.Message,name:e.Name}}))},status:h.Success}};y(c.TX_CHAT_QUICK_TEXT_RESPONSE,{agentUserId:e,caseId:t,sendbirdChannelUrl:a,status:h.Success,payload:s}),n.sendMessage(o)})).catch((function(e){n.sendErrorMessage(e.message,l.QuickText)}))}},{key:"handleTransferQueuesRequest",value:function(){var n=this;this.apexController.getTransferQueues().then((function(r){var s={type:l.TransferQueues,payload:{data:{items:r.map((function(e){return{id:e.Queue_ID__c,name:e.MasterLabel}}))},status:h.Success}};y(c.TX_CHAT_TRANSFER_QUEUES_RESPONSE,{agentUserId:e,caseId:t,sendbirdChannelUrl:a,status:h.Success,payload:r}),n.sendMessage(s)})).catch((function(r){n.sendErrorMessage(r.message,l.TransferQueues),y(c.TX_CHAT_TRANSFER_QUEUES_RESPONSE,{agentUserId:e,caseId:t,sendbirdChannelUrl:a,error:r.message,status:h.Error})}))}},{key:"handleShouldConnectRequest",value:function(){var n=this;this.apexController.shouldConnectToChat(t,e).then((function(r){var s={type:l.ShouldConnect,payload:{data:r,status:h.Success}};y(c.TX_CHAT_SHOULD_CONNECT_RESPONSE,{agentUserId:e,caseId:t,sendbirdChannelUrl:a,status:h.Success}),n.sendMessage(s)})).catch((function(r){y(c.TX_CHAT_SHOULD_CONNECT_RESPONSE,{agentUserId:e,caseId:t,sendbirdChannelUrl:a,status:h.Error}),n.sendErrorMessage(r.message,l.ShouldConnect)}))}},{key:"handleChatInfoRequest",value:function(){var t=this;this.apexController.getAgentChatUser(e,a).then((function(e){var n={type:l.ChatInfo,payload:{data:{sendbirdAppId:e.applicationId,sendbirdChannelUrl:a,sendbirdToken:e.chatUserAccessToken,sendbirdUserId:e.chatUserId},status:h.Success}};t.sendMessage(n)})).catch((function(e){t.sendErrorMessage(e.message,l.ChatInfo)}))}},{key:"sendMessage",value:function(e){console.log("[Controller] Sending message.",e);var t=function(){if(!s)throw new Error("Missing window.sendbirdSFDCInstance!");return s}();this.child.postMessage(e,t)}},{key:"sendErrorMessage",value:function(e,t){console.log("[Controller] Sending error message.",e),this.sendMessage({type:t,payload:{status:h.Error,message:e}})}}]),n}();function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.controller=window.CDdSendbirdChatController}return function(e,t,n){t&&I(e.prototype,t)}(e,[{key:"endChat",value:function(e){return this.makeRequest("endChat",!1,e)}},{key:"transferChat",value:function(e,t){return this.makeRequest("transferChat",!1,e,t)}},{key:"getAgentChatUser",value:function(e,t){return this.makeRequest("getAgentChatUser",!0,e,t)}},{key:"getQuickText",value:function(){return this.makeRequest("getQuickText",!1)}},{key:"getTransferQueues",value:function(){return this.makeRequest("getChatQueues",!0)}},{key:"shouldConnectToChat",value:function(e,t){return this.makeRequest("shouldConnectToChat",!1,e,t)}},{key:"makeRequest",value:function(e,t){for(var n,r=this,a=arguments.length,s=new Array(a>2?a-2:0),o=2;o<a;o++)s[o-2]=arguments[o];return(n=console).log.apply(n,["[Controller] sending remote action request: ",e].concat(s)),new Promise((function(n,a){var o;(o=r.controller)[e].apply(o,s.concat([function(r,s){if(s.statusCode>=400)return a(s);console.log("[Controller] received remote action response for method : ",e,r);try{return n(t?JSON.parse(r.replace(/(&quot\;)/g,'"')):r)}catch(e){return a(e)}}]))}))}}]),e}();window.onload=function(){var e=new k(new w,function(e){var t=document.getElementById("sendbird-chat-iframe").contentWindow;if(!t)throw new Error("iframe not found");return t}());window.addEventListener("message",(function(t){console.log("[Controller] Received message: ",t),g?e.handleMessage(t.data):console.log("[Controller] Received message with unexpected format, ignoring.",t)}))}})()})();